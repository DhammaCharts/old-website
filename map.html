<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Static Image</title>
	<script src="https://cdn.jsdelivr.net/npm/ol@v7.2.2/dist/ol.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.2.2/ol.css">

	<style>
		.map {
			width: 100%;
			height: 100vh;
		}

		.cross {
			top: 65px;
			left: .5em;
		}
	</style>
</head>

<body>
	<div id="map" class="map"></div>
	<!-- Pointer events polyfill for old browsers, see https://caniuse.com/#feat=pointer -->
	<script src="https://cdn.jsdelivr.net/npm/elm-pep@1.0.6/dist/elm-pep.js"></script>
	<script>

		const ImageLayer = ol.layer.Image;
		const Map = ol.Map;
		const Projection = ol.proj.Projection;
		const Static = ol.source.ImageStatic;
		const View = ol.View;
		const { getCenter } = ol.extent;
		const { platformModifierKeyOnly } = ol.events.condition;
		const { Stroke, Fill, Style, Circle } = ol.style;
		const { DragRotate } = ol.interaction;
		const { FullScreen } = ol.control;
		const { defaults } = ol.interaction.defaults;
		const { Control } = ol.control;
		const { defaultControls } = ol.control.defaults;

		var button = document.createElement('button');
		button.innerHTML = '&times;';

		var handle = function (e) {
			history.back();
		};

		button.addEventListener('click', handle, false);

		var element = document.createElement('div');
		element.className = 'cross ol-unselectable ol-control';
		element.appendChild(button);

		var OneControl = new ol.control.Control({
			element: element
		});

		const queryString = window.location.search;
		const urlParams = new URLSearchParams(queryString);
		const mapUrl = urlParams.get('map-url')
		const zoomMax = urlParams.get('zoom-max')
		const zoomMin = urlParams.get('zoom-min')

		const img = document.createElement('img');
		img.onload = function () {
			console.log("image loaded", img.width, img.height)
			const extent = [0, 0, img.width, img.height];
			const projection = new Projection({
				code: 'xkcd-image',
				units: 'pixels',
				extent: extent,
			});

			const map = new Map({
				layers: [
					new ImageLayer({
						source: new Static({
							attributions: '',
							url: mapUrl,
							projection: projection,
							imageExtent: extent,
						}),
					}),
				],
				target: 'map',
				view: new View({
					projection: projection,
					center: getCenter(extent),
					zoom: zoomMin ? zoomMin : 1,
					maxZoom: zoomMax ? zoomMax : undefined,
				}),
				// use ctrl/cmd + drag for rotation //
				interactions: defaults({ altShiftDragRotate: false }).extend([new DragRotate({ condition: platformModifierKeyOnly })]),

			});
			map.addControl(OneControl);

		}
		img.src = mapUrl;

	</script>
</body>

</html>